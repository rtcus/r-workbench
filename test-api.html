<!DOCTYPE html>
<html>
<head>
    <title>API 功能测试</title>
    <script src="js/api-client.js"></script>
    <style>
        body { font-family: Arial; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .pass { background: #d4edda; }
        .fail { background: #f8d7da; }
    </style>
</head>
<body>
    <h1>API 功能测试</h1>
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        
        function addResult(name, passed, error) {
            const div = document.createElement('div');
            div.className = `test ${passed ? 'pass' : 'fail'}`;
            div.innerHTML = `
                <strong>${name}</strong>: ${passed ? '✅ 通过' : '❌ 失败'}
                ${error ? `<br><small>${error}</small>` : ''}
            `;
            results.appendChild(div);
        }
        
        async function runTests() {
            // 测试 1: AV.Object 构造函数
            try {
                const obj = new AV.Object('TestClass');
                obj.set('name', 'test');
                addResult('AV.Object 构造函数', obj.get('name') === 'test');
            } catch (e) {
                addResult('AV.Object 构造函数', false, e.message);
            }
            
            // 测试 2: AV.Query 基本方法
            try {
                const query = new AV.Query('TestClass');
                query.equalTo('name', 'test')
                     .notEqualTo('age', 0)
                     .greaterThanOrEqualTo('score', 60)
                     .lessThanOrEqualTo('score', 100)
                     .contains('title', 'hello')
                     .containedIn('status', ['active', 'pending'])
                     .notContainedIn('type', ['deleted'])
                     .exists('email')
                     .doesNotExist('deletedAt')
                     .limit(10)
                     .skip(0)
                     .ascending('createdAt')
                     .descending('updatedAt')
                     .addAscending('name')
                     .addDescending('score')
                     .include('user')
                     .select('name', 'email');
                addResult('AV.Query 所有方法', true);
            } catch (e) {
                addResult('AV.Query 所有方法', false, e.message);
            }
            
            // 测试 3: AV.User 方法
            try {
                const hasCurrentUser = typeof AV.User.current === 'function';
                const hasLogIn = typeof AV.User.logIn === 'function';
                const hasLogOut = typeof AV.User.logOut === 'function';
                addResult('AV.User 方法', hasCurrentUser && hasLogIn && hasLogOut);
            } catch (e) {
                addResult('AV.User 方法', false, e.message);
            }
            
            // 测试 4: AV.Object 静态方法
            try {
                const TestClass = AV.Object.extend('TestClass');
                const obj1 = new TestClass();
                const obj2 = AV.Object.createWithoutData('TestClass', 'testId');
                addResult('AV.Object.extend & createWithoutData', true);
            } catch (e) {
                addResult('AV.Object.extend & createWithoutData', false, e.message);
            }
            
            // 测试 5: AV.File
            try {
                const hasFileClass = typeof AV.File === 'function';
                addResult('AV.File 类', hasFileClass);
            } catch (e) {
                addResult('AV.File 类', false, e.message);
            }
            
            // 测试 6: APIClient 实例
            try {
                const hasApi = typeof api !== 'undefined';
                const hasLogin = typeof api.login === 'function';
                const hasQuery = typeof api.query === 'function';
                const hasCount = typeof api.count === 'function';
                const hasSave = typeof api.save === 'function';
                const hasUpdate = typeof api.update === 'function';
                const hasDelete = typeof api.delete === 'function';
                addResult('APIClient 实例方法', 
                    hasApi && hasLogin && hasQuery && hasCount && hasSave && hasUpdate && hasDelete);
            } catch (e) {
                addResult('APIClient 实例方法', false, e.message);
            }
            
            console.log('✅ 所有测试完成！');
        }
        
        runTests();
    </script>
</body>
</html>
