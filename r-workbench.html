<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R跟单台系统</title>
    <!-- 引入样式和脚本 -->
    <link rel="stylesheet" href="https://cdn.rtcus.cn/libs/flatpickr/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.rtcus.cn/libs/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.rtcus.cn/libs/font-awesome/css/all.min.css">
    <link rel="stylesheet" href="css/common.css">
    <!-- API客户端 - 替换LeanCloud直接调用 -->
    <script src="js/api-client.js"></script>
    <script src="https://cdn.rtcus.cn/libs/flatpickr/flatpickr.min.js"></script>
    <script src="https://cdn.rtcus.cn/libs/flatpickr/l10n/zh.js"></script>
    <script src="https://cdn.rtcus.cn/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.rtcus.cn/libs/xlsx/xlsx.full.min.js"></script>
</head>
<body>
    <!-- 登录模态框 -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">R跟单台系统登录</h5>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginUsername" class="form-label">用户名</label>
                            <input type="text" class="form-control" id="loginUsername" required>
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">密码</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="rememberMe">
                            <label class="form-check-label" for="rememberMe">记住我</label>
                        </div>
                    </form>
                    <div class="alert alert-danger mt-3" id="loginError" style="display: none;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="loginBtn">登录</button>
                </div>
            </div>
        </div>
    </div>

    <div class="app-container" style="display: none;">
        <!-- 侧边导航栏 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>R跟单台系统</h3>
            </div>
            <ul class="nav-links">
                <li><a href="#" class="nav-link active" data-page="home">首页</a></li>
                <li><a href="#" class="nav-link" data-page="tracking">跟单工作台</a></li>
                <li><a href="#" class="nav-link" data-page="customs">报关数据管理</a></li>
                <li><a href="#" class="nav-link" data-page="hscode">HS编码管理</a></li>
                <li><a href="#" class="nav-link" data-page="exporter">出口商管理</a></li>
                <li><a href="#" class="nav-link" data-page="files">文件管理</a></li>
                <li class="user-info">
                    <div class="d-flex align-items-center">
                        <div class="user-avatar" id="userAvatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <div id="userName" style="font-size: 0.9rem;"></div>
                            <a href="#" class="text-white" id="logoutBtn" style="font-size: 0.8rem; text-decoration: none;">
                                <i class="fas fa-sign-out-alt"></i> 退出登录
                            </a>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
        
        <!-- 主内容区 -->
        <div class="main-content">
            <!-- 首页内容 -->
            <div id="home" class="page-content">
                <div class="page-header">
                    <h2>首页</h2>
                    <p class="text-muted">系统概览与跟进状态</p>
                </div>

                <!-- 跟进状态卡片 -->
                <div class="row mt-4">
                    <div class="col-md-3">
                        <div class="status-card" id="quarantineCard">
                            <h4>检疫证未出</h4>
                            <div class="count text-warning" id="quarantineCount">0</div>
                            <p class="card-text">已放行但无检疫证</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="status-card" id="inspectionCard">
                            <h4>查验未完成</h4>
                            <div class="count text-danger" id="inspectionCount">0</div>
                            <p class="card-text">查验中的报关单</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="status-card" id="unprintedCheckCard">
                            <h4>未打印核对单</h4>
                            <div class="count text-info" id="unprintedCheckCount">0</div>
                            <p class="card-text">待处理核对单</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="status-card" id="missingDataCard">
                            <h4>缺资料</h4>
                            <div class="count text-secondary" id="missingDataCount">0</div>
                            <p class="card-text">资料不完整的报关单</p>
                        </div>
                    </div>
                </div>

                <!-- 快速导航 -->
                <div class="row mt-5">
                    <div class="col-12">
                        <h4>快速导航</h4>
                    </div>
                    <div class="col-md-4">
                        <div class="quick-link" data-page="tracking">
                            <i class="fas fa-tasks fa-3x text-primary mb-3"></i>
                            <h4>跟单工作台</h4>
                            <p>源数据管理与跟踪</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="quick-link" data-page="customs">
                            <i class="fas fa-file-alt fa-3x text-success mb-3"></i>
                            <h4>报关数据</h4>
                            <p>报关数据管理</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="quick-link" data-page="files">
                            <i class="fas fa-folder fa-3x text-warning mb-3"></i>
                            <h4>文件管理</h4>
                            <p>文件上传与匹配</p>
                        </div>
                    </div>
                </div>
                <!-- ==================== 在这行后面添加 ==================== -->

<!-- 常用链接模块 -->
<div class="row mt-5" id="quickLinksSection">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4>常用链接</h4>
            <div>
                <button class="btn btn-sm btn-outline-primary me-2" id="refreshQuickLinks">
                    <i class="fas fa-sync-alt"></i> 刷新
                </button>
                <button class="btn btn-sm btn-primary" id="addQuickLink">
                    <i class="fas fa-plus"></i> 添加链接
                </button>
            </div>
        </div>
        
        <div class="quick-links-container" id="quickLinksContainer">
            <div class="text-center text-muted py-5" id="quickLinksLoading">
                <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                <p>正在加载常用链接...</p>
            </div>
        </div>
    </div>
</div>
            </div>
            
            <!-- 跟单工作台内容 -->
            <div id="tracking" class="page-content hidden">
                <div class="page-header">
                    <h2>跟单工作台</h2>
                    <p class="text-muted">源数据管理</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        查询条件
                    </div>
                    <div class="card-body">
                        <div class="row g-2 search-form">
                            <div class="col-md-2">
                                <label for="arrivalDate" class="form-label">到港日期</label>
                                <input type="text" class="form-control date-input" id="arrivalDate" placeholder="选择日期范围">
                            </div>
                            <div class="col-md-2">
                                <label for="billNo" class="form-label">提单号</label>
                                <input type="text" class="form-control" id="billNo">
                            </div>
                            <div class="col-md-2">
                                <label for="containerNo" class="form-label">柜号</label>
                                <input type="text" class="form-control" id="containerNo">
                            </div>
                            <div class="col-md-2">
                                <label for="declareDate" class="form-label">申报日期</label>
                                <input type="text" class="form-control date-input" id="declareDate" placeholder="选择日期范围">
                            </div>
                            <div class="col-md-2">
                                <label for="customsStatusFilter" class="form-label">报关状态</label>
                                <select class="form-select" id="customsStatusFilter">
                                    <option value="">全部状态</option>
                                    <option value="放行">放行</option>
                                    <option value="目的地查验">目的地查验</option>
                                    <option value="审结">审结</option>
                                    <option value="口岸查验">口岸查验</option>
                                    <option value="无电子信息">无电子信息</option>
                                    <option value="合并检查">合并检查</option>
                                    <option value="挂起">挂起</option>
                                    <option value="非放行">非放行</option>
                                    <!-- 新增删单选项 -->
                                    <option value="删单">删单</option>
                                </select>
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <div class="w-100">
                                    <button class="btn btn-primary w-100" id="searchTracking">查询</button>
                                    <button class="btn btn-outline-secondary w-100 mt-1" id="clearTracking">清空</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 表格和分页统一容器 -->
                <div class="table-card-container">
                    <div class="table-card-header d-flex justify-content-between align-items-center">
                        <span>跟单列表</span>
                        <div>
                            <button class="btn btn-sm btn-outline-primary me-2" id="importTracking">
                                <i class="fas fa-upload"></i> 导入
                            </button>
                            <button class="btn btn-sm btn-primary" id="addTracking">新增跟单</button>
                        </div>
                    </div>
                    
                    <div class="table-content-wrapper">
                        <!-- 表格内容区域 -->
                        <div class="table-container">
                            <table class="table table-hover" id="trackingTable">
                                <thead>
                                    <tr>
                                        <th>序号</th>
                                        <th>到港日期</th>
                                        <th>申报日期</th>
                                        <th>预录入号</th>
                                        <th>提单号</th>
                                        <th>柜号</th>
                                        <th>报关单号</th>
                                        <th>欧盟保证金</th>
                                        <th>国家</th>
                                        <th>品名</th>
                                        <th>操作</th>
                                        <th>报关状态</th>
                                        <th>指令</th>
                                        <th>备注</th>
                                        <th>单证信息</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- 数据将通过JavaScript动态填充 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 固定在容器底部的分页控件 -->
                        <div class="pagination-container" id="paginationContainer">
                            <div class="pagination-info" id="paginationInfo">
                                共 0 页，每页显示 10 条，共 0 条记录
                            </div>
                            <nav aria-label="Page navigation">
                                <ul class="pagination" id="pagination">
                                    <!-- 分页将通过JavaScript动态生成 -->
                                </ul>
                            </nav>
                            <div class="page-size-selector">
                                <span>每页显示：</span>
                                <select class="form-select form-select-sm" id="pageSizeSelect">
                                    <option value="20">20条</option>
                                    <option value="50">50条</option>
                                    <option value="100">100条</option>
                                    <option value="300">300条</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 报关数据管理内容 -->
            <div id="customs" class="page-content hidden">
                <div class="page-header">
                    <h2>报关数据管理</h2>
                    <p class="text-muted">报关数据列表</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        查询条件
                    </div>
                    <div class="card-body">
                        <div class="row g-2 search-form">
                            <div class="col-md-2">
                                <label for="customsArrivalDate" class="form-label">到港日期</label>
                                <input type="text" class="form-control date-input" id="customsArrivalDate" placeholder="选择日期范围">
                            </div>
                            <div class="col-md-2">
                                <label for="customsBillNo" class="form-label">提单号</label>
                                <input type="text" class="form-control" id="customsBillNo">
                            </div>
                            <div class="col-md-2">
                                <label for="customsContainerNo" class="form-label">柜号</label>
                                <input type="text" class="form-control" id="customsContainerNo">
                            </div>
                            <div class="col-md-2">
                                <label for="customsDeclareDate" class="form-label">申报日期</label>
                                <input type="text" class="form-control date-input" id="customsDeclareDate" placeholder="选择日期范围">
                            </div>
                            <div class="col-md-2">
                                <label for="customsNoFilter" class="form-label">报关单号</label>
                                <input type="text" class="form-control" id="customsNoFilter" placeholder="输入报关单号">
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <div class="w-100">
                                    <button class="btn btn-primary w-100" id="searchCustoms">查询</button>
                                    <button class="btn btn-outline-secondary w-100 mt-1" id="clearCustoms">清空</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 表格和分页统一容器 -->
                <div class="table-card-container">
                    <div class="table-card-header d-flex justify-content-between align-items-center">
                        <span>报关数据列表</span>
                        <div>
                            <button class="btn btn-sm btn-outline-primary me-2" id="importCustoms">
                                <i class="fas fa-upload"></i> 导入
                            </button>
                            <button class="btn btn-sm btn-outline-success" id="exportCustoms">
                                <i class="fas fa-download"></i> 导出
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-content-wrapper">
                        <!-- 表格内容区域 -->
                        <div class="table-container">
                            <table class="table table-hover customs-table" id="customsTable">
                                <thead>
                                    <tr>
                                        <th>序号</th>
                                        <th>到港日期</th>
                                        <th>申报日期</th>
                                        <th>预录入号</th>
                                        <th>报关状态</th>
                                        <th>指令</th>
                                        <th>单证信息</th>
                                        <th>提单号</th>
                                        <th>柜号</th>
                                        <th>报关单号</th>
                                        <th>欧盟保证金</th>
                                        <th>国家</th>
                                        <th>品名</th>
                                        <th>境内收发货人</th>
                                        <th>消费使用单位</th>
                                        <th>境外收发货人</th>
                                        <th>HS编码</th>
                                        <th>监管类别名称</th>
                                        <th>规格型号</th>
                                        <th>货值</th>
                                        <th>币制</th>
                                        <th>厂号</th>
                                        <th>发货人备案号</th>
                                        <th>件数</th>
                                        <th>净重</th>
                                        <th>毛重</th>
                                        <th>105证书</th>
                                        <th>325证书</th>
                                        <th>519证书</th>
                                        <th>113证书</th>
                                        <th>检验检疫货物规格</th>
                                        <th>生产日期</th>
                                        <th>备注</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- 数据将通过JavaScript动态填充 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 固定在容器底部的分页控件 -->
                        <div class="pagination-container" id="customsPaginationContainer">
                            <div class="pagination-info" id="customsPaginationInfo">
                                共 0 页，每页显示 10 条，共 0 条记录
                            </div>
                            <nav aria-label="Page navigation">
                                <ul class="pagination" id="customsPagination">
                                    <!-- 分页将通过JavaScript动态生成 -->
                                </ul>
                            </nav>
                            <div class="page-size-selector">
                                <span>每页显示：</span>
                                <select class="form-select form-select-sm" id="customsPageSizeSelect">
                                    <option value="20">20条</option>
                                    <option value="50">50条</option>
                                    <option value="100">100条</option>
                                    <option value="300">300条</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- HS编码管理内容 -->
            <div id="hscode" class="page-content hidden">
                <div class="page-header">
                    <h2>HS编码管理</h2>
                    <p class="text-muted">HS编码查询与维护</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        查询条件
                    </div>
                    <div class="card-body">
                        <div class="row g-2 search-form">
                            <div class="col-md-3">
                                <label for="hsCodeSearch" class="form-label">HS编码</label>
                                <input type="text" class="form-control" id="hsCodeSearch" placeholder="输入HS编码">
                            </div>
                            <div class="col-md-3">
                                <label for="productNameSearch" class="form-label">品名</label>
                                <input type="text" class="form-control" id="productNameSearch" placeholder="输入品名">
                            </div>
                            <div class="col-md-3 d-flex align-items-end">
                                <div class="w-100">
                                    <button class="btn btn-primary w-100" id="searchHSCode">查询</button>
                                    <button class="btn btn-outline-secondary w-100 mt-1" id="clearHSCode">清空</button>
                                </div>
                            </div>
                            <div class="col-md-3 d-flex align-items-end">
                                <div class="w-100">
                                    <button class="btn btn-outline-success w-100" id="syncHSCode">
                                        <i class="fas fa-sync"></i> 同步报关数据
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 表格容器 -->
                <div class="table-card-container">
                    <div class="table-card-header d-flex justify-content-between align-items-center">
                        <span>HS编码列表</span>
                        <div class="pagination-info" id="hscodePaginationInfo">
                            共 0 条记录
                        </div>
                    </div>
                    
                    <div class="table-content-wrapper">
                        <div class="table-container">
                            <table class="table table-hover" id="hscodeTable">
                                <thead>
                                    <tr>
                                        <th>序号</th>
                                        <th>HS编码</th>
                                        <th>品名</th>
                                        <th>监管类别名称</th>
                                        <th>规格型号</th>
                                        <th>同步时间</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- 数据动态填充 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="pagination-container">
                            <nav aria-label="Page navigation">
                                <ul class="pagination" id="hscodePagination">
                                    <!-- 分页动态生成 -->
                                </ul>
                            </nav>
                            <div class="page-size-selector">
                                <span>每页显示：</span>
                                <select class="form-select form-select-sm" id="hscodePageSizeSelect">
                                    <option value="20">20条</option>
                                    <option value="50">50条</option>
                                    <option value="100">100条</option>
                                    <option value="300">300条</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 出口商管理内容 -->
            <div id="exporter" class="page-content hidden">
                <div class="page-header">
                    <h2>出口商管理</h2>
                    <p class="text-muted">出口商信息管理</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        查询条件
                    </div>
                    <div class="card-body">
                        <div class="row g-2 search-form">
                            <div class="col-md-3">
                                <label for="foreignConsigneeSearch" class="form-label">境外收发货人</label>
                                <input type="text" class="form-control" id="foreignConsigneeSearch" placeholder="输入境外收发货人">
                            </div>
                            <div class="col-md-3">
                                <label for="shipperRecordNoSearch" class="form-label">发货人备案号</label>
                                <input type="text" class="form-control" id="shipperRecordNoSearch" placeholder="输入发货人备案号">
                            </div>
                            <div class="col-md-3 d-flex align-items-end">
                                <div class="w-100">
                                    <button class="btn btn-primary w-100" id="searchExporter">查询</button>
                                    <button class="btn btn-outline-secondary w-100 mt-1" id="clearExporter">清空</button>
                                </div>
                            </div>
                            <div class="col-md-3 d-flex align-items-end">
                                <div class="w-100">
                                    <button class="btn btn-outline-success w-100" id="syncExporter">
                                        <i class="fas fa-sync"></i> 同步报关数据
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-card-container">
                    <div class="table-card-header d-flex justify-content-between align-items-center">
                        <span>出口商列表</span>
                        <div class="pagination-info" id="exporterPaginationInfo">
                            共 0 条记录
                        </div>
                    </div>
                    
                    <div class="table-content-wrapper">
                        <div class="table-container">
                            <table class="table table-hover" id="exporterTable">
                                <thead>
                                    <tr>
                                        <th>序号</th>
                                        <th>境外收发货人</th>
                                        <th>发货人备案号</th>
                                        <th>报关单号</th>
                                        <th>同步时间</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- 数据动态填充 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="pagination-container">
                            <nav aria-label="Page navigation">
                                <ul class="pagination" id="exporterPagination">
                                    <!-- 分页动态生成 -->
                                </ul>
                            </nav>
                            <div class="page-size-selector">
                                <span>每页显示：</span>
                                <select class="form-select form-select-sm" id="exporterPageSizeSelect">
                                    <option value="20">20条</option>
                                    <option value="50">50条</option>
                                    <option value="100">100条</option>
                                    <option value="300">300条</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 文件管理内容 -->
            <div id="files" class="page-content hidden">
                <div class="page-header">
                    <h2>文件管理</h2>
                    <p class="text-muted">文件上传与匹配</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        文件上传
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <label for="fileTypeSelect" class="form-label">附件类型</label>
                                <select class="form-select" id="fileTypeSelect">
                                    <option value="报关单">报关单</option>
                                    <option value="核对单">核对单</option>
                                    <option value="报关单证">报关单证</option>
                                    <option value="检疫证">检疫证</option>
                                    <option value="其他">其他</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="fileUpload" class="form-label">选择文件</label>
                                <input class="form-control" type="file" id="fileUpload" multiple>
                                <div class="form-text">支持多文件上传，系统会根据文件名自动匹配到对应的柜号或报关单号</div>
                            </div>
                            <div class="col-md-3 d-flex align-items-end">
                                <button class="btn btn-primary w-100" id="uploadFiles">
                                    <i class="fas fa-upload"></i> 上传文件
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        文件列表
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>序号</th>
                                        <th>文件名</th>
                                        <th>文件类型</th>
                                        <th>匹配的柜号</th>
                                        <th>匹配的报关单号</th>
                                        <th>上传时间</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="fileListBody">
                                    <!-- 文件列表动态填充 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 公共模态框 -->
    <!-- 检疫证未出模态框 -->
    <div class="modal fade" id="quarantineModal" tabindex="-1" aria-labelledby="quarantineModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="quarantineModalLabel">检疫证未出</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table modal-table">
                            <thead>
                                <tr>
                                    <th>序号</th>
                                    <th>报关单号</th>
                                    <th>提单号</th>
                                    <th>柜号</th>
                                </tr>
                            </thead>
                            <tbody id="quarantineList">
                                <!-- 检疫证未出数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 查验未完成模态框 -->
    <div class="modal fade" id="inspectionModal" tabindex="-1" aria-labelledby="inspectionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="inspectionModalLabel">查验未完成</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table modal-table">
                            <thead>
                                <tr>
                                    <th>序号</th>
                                    <th>报关单号</th>
                                    <th>提单号</th>
                                    <th>柜号</th>
                                    <th>指令</th>
                                </tr>
                            </thead>
                            <tbody id="inspectionList">
                                <!-- 查验未完成数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 未打印核对单模态框 -->
    <div class="modal fade" id="unprintedCheckModal" tabindex="-1" aria-labelledby="unprintedCheckModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="unprintedCheckModalLabel">未打印核对单</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table modal-table">
                            <thead>
                                <tr>
                                    <th>序号</th>
                                    <th>预录入号</th>
                                    <th>提单号</th>
                                    <th>柜号</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="unprintedCheckList">
                                <!-- 未打印核对单数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 缺资料模态框 -->
    <div class="modal fade" id="missingDataModal" tabindex="-1" aria-labelledby="missingDataModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="missingDataModalLabel">缺资料</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table modal-table">
                            <thead>
                                <tr>
                                    <th>序号</th>
                                    <th>到港日期</th>
                                    <th>提单号</th>
                                    <th>柜号</th>
                                    <th>报关单号</th>
                                </tr>
                            </thead>
                            <tbody id="missingDataList">
                                <!-- 缺资料数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 新增跟单模态框 -->
    <div class="modal fade" id="trackingModal" tabindex="-1" aria-labelledby="trackingModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="trackingModalLabel">新增跟单</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="trackingForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="newContainerNo" class="form-label">柜号 *</label>
                                <input type="text" class="form-control" id="newContainerNo" required>
                                <div class="duplicate-message" id="containerNoError"></div>
                            </div>
                            <div class="col-md-6">
                                <label for="newBillNo" class="form-label">提单号</label>
                                <input type="text" class="form-control" id="newBillNo">
                                <div class="duplicate-message" id="billNoError"></div>
                            </div>
                            <div class="col-md-6">
                                <label for="newArrivalDate" class="form-label">到港日期 *</label>
                                <input type="text" class="form-control date-input" id="newArrivalDate" required>
                            </div>
                            <div class="col-md-6">
                                <label for="newCountry" class="form-label">国家</label>
                                <input type="text" class="form-control" id="newCountry">
                            </div>
                            <div class="col-md-6">
                                <label for="newProductName" class="form-label">商品描述</label>
                                <input type="text" class="form-control" id="newProductName">
                            </div>
                            <div class="col-md-6">
                                <label for="newShipper" class="form-label">发货人</label>
                                <input type="text" class="form-control" id="newShipper">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="saveTracking">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 导入跟单模态框 -->
    <div class="modal fade" id="importTrackingModal" tabindex="-1" aria-labelledby="importTrackingModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="importTrackingModalLabel">批量导入跟单数据</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <h6>导入说明：</h6>
                        <ul class="mb-0">
                            <li>支持 Excel (.xlsx, .xls) 和 CSV 文件格式</li>
                            <li>请确保文件包含以下列：柜号、到港日期、提单号、国家、商品描述、发货人、预录入号</li>
                            <li>柜号和到港日期为必填字段</li>
                            <li>第一行应为表头，数据从第二行开始</li>
                        </ul>
                    </div>
                    
                    <div class="mb-3">
                        <label for="importFile" class="form-label">选择文件</label>
                        <input class="form-control" type="file" id="importFile" accept=".xlsx,.xls,.csv">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">模板下载</label>
                        <div>
                            <button class="btn btn-outline-primary btn-sm" id="downloadTemplate">
                                <i class="fas fa-download"></i> 下载导入模板
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h6>预览数据</h6>
                        <div class="table-responsive" style="max-height: 300px;">
                            <table class="table table-sm table-bordered import-preview-table" id="importPreviewTable">
                                <thead>
                                    <tr>
                                        <th>状态</th>
                                        <th>柜号</th>
                                        <th>到港日期</th>
                                        <th>提单号</th>
                                        <th>国家</th>
                                        <th>商品描述</th>
                                        <th>发货人</th>
                                        <th>预录入号</th>
                                        <th>错误信息</th>
                                    </tr>
                                </thead>
                                <tbody id="importPreviewBody">
                                    <!-- 预览数据将通过JavaScript动态填充 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="skipDuplicates" checked>
                            <label class="form-check-label" for="skipDuplicates">
                                跳过重复数据（根据柜号判断）
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="confirmImport" disabled>确认导入</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 附件上传模态框 -->
    <div class="modal fade" id="attachmentModal" tabindex="-1" aria-labelledby="attachmentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="attachmentModalLabel">附件管理</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="attachmentType" class="form-label">附件类型</label>
                        <select class="form-select" id="attachmentType">
                            <option value="报关单">报关单</option>
                            <option value="核对单">核对单</option>
                            <option value="报关单证">报关单证</option>
                            <option value="检疫证">检疫证</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="attachmentFile" class="form-label">选择文件</label>
                        <input class="form-control" type="file" id="attachmentFile" multiple>
                    </div>
                    <div class="mt-3">
                        <button class="btn btn-primary" id="uploadAttachment">上传附件</button>
                    </div>
                    
                    <div class="mt-4">
                        <h6>附件列表</h6>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>序号</th>
                                        <th>附件类型</th>
                                        <th>文件名</th>
                                        <th>上传时间</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="attachmentList">
                                    <!-- 附件列表将通过JavaScript动态填充 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 导入结果模态框 -->
    <div class="modal fade import-result-modal" id="importResultModal" tabindex="-1" aria-labelledby="importResultModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="importResultModalLabel">导入结果</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-success" id="importSuccessAlert" style="display: none;">
                        <h6><i class="fas fa-check-circle"></i> 导入成功</h6>
                        <p id="importSuccessMessage"></p>
                    </div>
                    
                    <div class="alert alert-danger" id="importErrorAlert" style="display: none;">
                        <h6><i class="fas fa-exclamation-triangle"></i> 导入失败</h6>
                        <p id="importErrorMessage"></p>
                    </div>
                    
                    <div class="mt-4" id="failedDataSection" style="display: none;">
                        <h6>失败数据详情</h6>
                        <div class="table-responsive" style="max-height: 400px;">
                            <table class="table table-sm table-bordered import-result-table">
                                <thead>
                                    <tr>
                                        <th>行号</th>
                                        <th>柜号</th>
                                        <th>到港日期</th>
                                        <th>提单号</th>
                                        <th>国家</th>
                                        <th>商品描述</th>
                                        <th>发货人</th>
                                        <th>预录入号</th>
                                        <th>失败原因</th>
                                    </tr>
                                </thead>
                                <tbody id="failedDataBody">
                                    <!-- 失败数据将通过JavaScript动态填充 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" id="exportFailedData" style="display: none;">
                        <i class="fas fa-download"></i> 导出失败数据
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 报关数据录入模态框 -->
    <div class="modal fade" id="customsDataModal" tabindex="-1" aria-labelledby="customsDataModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="customsDataModalLabel">报关数据录入</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="customsDataForm">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="editCountry" class="form-label">国家</label>
                                <input type="text" class="form-control" id="editCountry">
                            </div>
                            <div class="col-md-4">
                                <label for="editProductName" class="form-label">品名</label>
                                <input type="text" class="form-control" id="editProductName">
                            </div>
                            <div class="col-md-4">
                                <label for="editDomesticConsignee" class="form-label">境内收发货人</label>
                                <input type="text" class="form-control" id="editDomesticConsignee">
                            </div>
                            <div class="col-md-4">
                                <label for="editConsumptionUnit" class="form-label">消费使用单位</label>
                                <input type="text" class="form-control" id="editConsumptionUnit">
                            </div>
                            <div class="col-md-4">
                                <label for="editForeignConsignee" class="form-label">境外收发货人</label>
                                <input type="text" class="form-control" id="editForeignConsignee">
                            </div>
                            <div class="col-md-4">
                                <label for="editHsCode" class="form-label">HS编码</label>
                                <input type="text" class="form-control" id="editHsCode">
                            </div>
                            <div class="col-md-4">
                                <label for="editSupervisionCategory" class="form-label">监管类别名称</label>
                                <input type="text" class="form-control" id="editSupervisionCategory">
                            </div>
                            <div class="col-md-4">
                                <label for="editSpecification" class="form-label">规格型号</label>
                                <input type="text" class="form-control" id="editSpecification">
                            </div>
                            <div class="col-md-4">
                                <label for="editGoodsValue" class="form-label">货值</label>
                                <input type="text" class="form-control" id="editGoodsValue">
                            </div>
                            <div class="col-md-4">
                                <label for="editCurrency" class="form-label">币制</label>
                                <input type="text" class="form-control" id="editCurrency">
                            </div>
                            <div class="col-md-4">
                                <label for="editFactoryNo" class="form-label">厂号</label>
                                <input type="text" class="form-control" id="editFactoryNo">
                            </div>
                            <div class="col-md-4">
                                <label for="editShipperRecordNo" class="form-label">发货人备案号</label>
                                <input type="text" class="form-control" id="editShipperRecordNo">
                            </div>
                            <div class="col-md-4">
                                <label for="editPackageCount" class="form-label">件数</label>
                                <input type="text" class="form-control" id="editPackageCount">
                            </div>
                            <div class="col-md-4">
                                <label for="editNetWeight" class="form-label">净重</label>
                                <input type="text" class="form-control" id="editNetWeight">
                            </div>
                            <div class="col-md-4">
                                <label for="editGrossWeight" class="form-label">毛重</label>
                                <input type="text" class="form-control" id="editGrossWeight">
                            </div>
                            <div class="col-md-4">
                                <label for="editCertificate105" class="form-label">105证书</label>
                                <input type="text" class="form-control" id="editCertificate105">
                            </div>
                            <div class="col-md-4">
                                <label for="editCertificate325" class="form-label">325证书</label>
                                <input type="text" class="form-control" id="editCertificate325">
                            </div>
                            <!-- 补充：519证书字段 -->
                            <div class="col-md-4">
                                <label for="editCertificate519" class="form-label">519证书</label>
                                <input type="text" class="form-control" id="editCertificate519">
                            </div>
                            <div class="col-md-4">
                                <label for="editCertificate113" class="form-label">113证书</label>
                                <input type="text" class="form-control" id="editCertificate113">
                            </div>
                            <div class="col-md-4">
                                <label for="editInspectionSpec" class="form-label">检验检疫货物规格</label>
                                <input type="text" class="form-control" id="editInspectionSpec">
                            </div>
                            <div class="col-md-4">
                                <label for="editProductionDate" class="form-label">生产日期</label>
                                <input type="text" class="form-control" id="editProductionDate" placeholder="输入生产日期">
                            </div>
                            <div class="col-12">
                                <label for="editCustomsRemark" class="form-label">备注</label>
                                <textarea class="form-control" id="editCustomsRemark" rows="3"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="saveCustomsData">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 导入报关数据模态框 -->
    <div class="modal fade" id="importCustomsModal" tabindex="-1" aria-labelledby="importCustomsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="importCustomsModalLabel">批量导入报关数据</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <h6>导入说明：</h6>
                        <ul class="mb-0">
                            <li>支持 Excel (.xlsx, .xls) 和 CSV 文件格式</li>
                            <li>请确保文件包含报关数据相关字段</li>
                            <li>柜号和到港日期为必填字段</li>
                            <li>第一行应为表头，数据从第二行开始</li>
                        </ul>
                    </div>
                    
                    <div class="mb-3">
                        <label for="importCustomsFile" class="form-label">选择文件</label>
                        <input class="form-control" type="file" id="importCustomsFile" accept=".xlsx,.xls,.csv">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">模板下载</label>
                        <div>
                            <button class="btn btn-outline-primary btn-sm" id="downloadCustomsTemplate">
                                <i class="fas fa-download"></i> 下载报关数据导入模板
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h6>预览数据</h6>
                        <div class="table-responsive" style="max-height: 300px;">
                            <table class="table table-sm table-bordered import-preview-table" id="importCustomsPreviewTable">
                                <thead>
                                    <tr>
                                        <th>状态</th>
                                        <th>柜号</th>
                                        <th>到港日期</th>
                                        <th>提单号</th>
                                        <th>报关单号</th>
                                        <th>国家</th>
                                        <th>品名</th>
                                        <th>预录入号</th>
                                        <th>申报日期</th>
                                        <th>错误信息</th>
                                    </tr>
                                </thead>
                                <tbody id="importCustomsPreviewBody">
                                    <!-- 预览数据将通过JavaScript动态填充 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="skipCustomsDuplicates" checked>
                            <label class="form-check-label" for="skipCustomsDuplicates">
                                跳过重复数据（根据柜号判断）
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="confirmCustomsImport" disabled>确认导入</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 引入JavaScript文件 -->
    <script src="js/common.js"></script>
    <script src="js/home.js"></script>
    <script src="js/tracking.js"></script>
    <script src="js/customs.js"></script>
    <script src="js/hscode.js"></script>
    <script src="js/exporter.js"></script>
    <script src="js/files.js"></script>
    
<!-- CDN失败自动回退机制 -->
<script>
(function() {
    // 配置回退映射
    const fallbackMap = {
        'bootstrap': {
            css: 'https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css',
            js: 'https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js'
        },
        'flatpickr': {
            css: 'https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css',
            js: 'https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.js',
            zh: 'https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/zh.js'
        },
        'font-awesome': {
            css: 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css'
        },
        'leancloud-storage': {
            js: 'https://cdn.jsdelivr.net/npm/leancloud-storage@4.13.2/dist/av-min.js'
        },
        'xlsx': {
            js: 'https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js'
        }
    };

    // 检测CDN是否可用的函数
    function checkCDNAvailability() {
        console.log('🔍 检查CDN可用性...');
        
        // 测试一个关键文件（Bootstrap CSS）
        const testUrl = 'https://cdn.rtcus.cn/libs/bootstrap/css/bootstrap.min.css';
        const xhr = new XMLHttpRequest();
        xhr.open('HEAD', testUrl + '?t=' + Date.now());
        xhr.timeout = 5000; // 5秒超时
        
        xhr.onload = function() {
            if (xhr.status >= 200 && xhr.status < 400) {
                console.log('✅ CDN正常可用');
            } else {
                console.warn('⚠️ CDN可能有问题，启用回退机制');
                enableFallback();
            }
        };
        
        xhr.onerror = xhr.ontimeout = function() {
            console.warn('🚨 CDN不可用，启用回退机制');
            enableFallback();
        };
        
        try {
            xhr.send();
        } catch (e) {
            enableFallback();
        }
    }

    // 启用回退机制
    function enableFallback() {
        console.log('🔄 切换到公共CDN...');
        
        // 替换所有资源链接
        document.querySelectorAll('link[href*="cdn.rtcus.cn"], script[src*="cdn.rtcus.cn"]').forEach(element => {
            const originalSrc = element.href || element.src;
            if (!originalSrc) return;
            
            // 找出对应的库
            for (const [lib, urls] of Object.entries(fallbackMap)) {
                if (originalSrc.includes(lib)) {
                    let newUrl = '';
                    const elementType = element.tagName;
                    
                    if (elementType === 'LINK' && urls.css) {
                        newUrl = urls.css;
                    } else if (elementType === 'SCRIPT') {
                        if (originalSrc.includes('l10n/zh.js') && urls.zh) {
                            newUrl = urls.zh;
                        } else if (urls.js) {
                            newUrl = urls.js;
                        }
                    }
                    
                    if (newUrl) {
                        console.log(`  替换: ${originalSrc} -> ${newUrl}`);
                        
                        if (elementType === 'SCRIPT') {
                            const newScript = document.createElement('script');
                            newScript.src = newUrl;
                            document.body.appendChild(newScript);
                        } else {
                            const newLink = document.createElement('link');
                            newLink.rel = 'stylesheet';
                            newLink.href = newUrl;
                            document.head.appendChild(newLink);
                        }
                    }
                    break;
                }
            }
        });
        
        // 显示回退提示（可选）
        showFallbackNotification();
    }

    // 显示回退提示
    function showFallbackNotification() {
        const notification = document.createElement('div');
        notification.id = 'cdn-fallback-notice';
        notification.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #ffc107;
            color: #856404;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 9999;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        `;
        notification.innerHTML = `
            <strong>⚠️ 使用备用资源</strong>
            <div>CDN暂时不可用，已切换到公共资源</div>
            <small>系统功能不受影响</small>
        `;
        document.body.appendChild(notification);
        
        // 5秒后自动隐藏
        setTimeout(() => {
            notification.style.opacity = '0';
            notification.style.transition = 'opacity 0.5s';
            setTimeout(() => notification.remove(), 500);
        }, 5000);
    }

    // 页面加载完成后检查CDN
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', checkCDNAvailability);
    } else {
        checkCDNAvailability();
    }

    // 监听资源加载失败
    window.addEventListener('error', function(e) {
        const target = e.target;
        if ((target.tagName === 'LINK' || target.tagName === 'SCRIPT') && 
            (target.href && target.href.includes('cdn.rtcus.cn') || 
             target.src && target.src.includes('cdn.rtcus.cn'))) {
            console.warn('资源加载失败，触发回退:', target.href || target.src);
            enableFallback();
        }
    }, true);
})();
</script>

</body>
</html>